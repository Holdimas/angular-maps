let id = 0;
/**
 * Abstract base implementing a canvas overlay to be placed on the map.
 *
 * @export
 * @abstract
 */
export class CanvasOverlay {
    /**
     * Creates a new instance of the CanvasOverlay class.
     */
    constructor(drawCallback) {
        this._canvasReady = new Promise((resolve, reject) => { this._readyResolver = resolve; });
        this._drawCallback = drawCallback;
        id++;
    }
    /**
     * Returns a promise that gets resolved when the canvas overlay is ready for interaction.
     */
    get CanvasReady() { return this._canvasReady; }
    ///
    /// Public methods
    ///
    /**
     * Deletes the canvas overlay.
     */
    Delete() {
        this.SetMap(null);
    }
    /**
     * CanvasOverlay added to map, load canvas.
     */
    OnAdd() {
        this._canvas = document.createElement('canvas');
        this._canvas.style.position = 'absolute';
        this._canvas.style.left = '0px';
        this._canvas.style.top = '0px';
        this._canvas.id = `xMapOverlay${id}`;
        // Add the canvas to the overlay.
        this.SetCanvasElement(this._canvas);
    }
    /**
     * When the CanvasLayer is removed from the map, release resources.
     * @memberof CanvasOverlay
     * @method
     */
    OnRemove() {
        this.SetCanvasElement(null);
        this.RemoveEventHandlers();
        this._canvas = null;
    }
    /**
     * Redraws the canvas for the current map view.
     * @param clear - True to clear the canvas before drawing.
     * @memberof CanvasOverlay
     * @method
     */
    Redraw(clear) {
        if (this._canvas == null) {
            return;
        }
        // Clear canvas by updating dimensions. This also ensures canvas stays the same size as the map.
        if (clear) {
            this.Resize();
        }
        // Call the drawing callback function if specified.
        if (this._drawCallback) {
            this._drawCallback(this._canvas);
        }
    }
    /**
     * Simple function for updating the CSS position and dimensions of the canvas.
     * @param x The horizontal offset position of the canvas.
     * @param y The vertical offset position of the canvas.
     * @param w The width of the canvas.
     * @param h The height of the canvas.
     * @memberof CanvasOverlay
     * @method
     * @protected
     */
    UpdatePosition(x, y, w, h) {
        // Update CSS position.
        this._canvas.style.left = x + 'px';
        this._canvas.style.top = y + 'px';
        // Update CSS dimensions.
        this._canvas.style.width = w + 'px';
        this._canvas.style.height = h + 'px';
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FudmFzLW92ZXJsYXkuanMiLCJzb3VyY2VSb290IjoiLi4vLi4vIiwic291cmNlcyI6WyJzcmMvbW9kZWxzL2NhbnZhcy1vdmVybGF5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUdBLElBQUksRUFBRSxHQUFXLENBQUMsQ0FBQztBQUVuQjs7Ozs7R0FLRztBQUNILE1BQU0sT0FBZ0IsYUFBYTtJQXNCL0I7O09BRUc7SUFDSCxZQUFZLFlBQWlEO1FBaEJ0RCxpQkFBWSxHQUFxQixJQUFJLE9BQU8sQ0FBVSxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsRUFBRSxHQUFHLElBQUksQ0FBQyxjQUFjLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFpQmxILElBQUksQ0FBQyxhQUFhLEdBQUcsWUFBWSxDQUFDO1FBQ2xDLEVBQUUsRUFBRSxDQUFDO0lBQ1QsQ0FBQztJQWpCRDs7T0FFRztJQUNILElBQVcsV0FBVyxLQUF1QixPQUFPLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO0lBZ0J4RSxHQUFHO0lBQ0gsa0JBQWtCO0lBQ2xCLEdBQUc7SUFFSDs7T0FFRztJQUNJLE1BQU07UUFDVCxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3RCLENBQUM7SUFvQkQ7O09BRUc7SUFDSSxLQUFLO1FBQ1IsSUFBSSxDQUFDLE9BQU8sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2hELElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLFFBQVEsR0FBRyxVQUFVLENBQUM7UUFDekMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQztRQUNoQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLEdBQUcsS0FBSyxDQUFDO1FBQy9CLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxHQUFHLGNBQWMsRUFBRSxFQUFFLENBQUM7UUFFckMsaUNBQWlDO1FBQ2pDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDeEMsQ0FBQztJQVVEOzs7O09BSUc7SUFDSSxRQUFRO1FBQ1gsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzVCLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO1FBQzNCLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO0lBQ3hCLENBQUM7SUFFRDs7Ozs7T0FLRztJQUNJLE1BQU0sQ0FBQyxLQUFjO1FBQ3hCLElBQUksSUFBSSxDQUFDLE9BQU8sSUFBSSxJQUFJLEVBQUU7WUFBRSxPQUFPO1NBQUU7UUFFckMsZ0dBQWdHO1FBQ2hHLElBQUksS0FBSyxFQUFFO1lBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1NBQUU7UUFFN0IsbURBQW1EO1FBQ25ELElBQUksSUFBSSxDQUFDLGFBQWEsRUFBRTtZQUNwQixJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUNwQztJQUNMLENBQUM7SUFpREQ7Ozs7Ozs7OztPQVNHO0lBQ08sY0FBYyxDQUFDLENBQVMsRUFBRSxDQUFTLEVBQUUsQ0FBUyxFQUFFLENBQVM7UUFDL0QsdUJBQXVCO1FBQ3ZCLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDO1FBQ25DLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDO1FBRWxDLHlCQUF5QjtRQUN6QixJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQztRQUNwQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQztJQUN6QyxDQUFDO0NBRUoiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJTGF0TG9uZyB9IGZyb20gJy4uL2ludGVyZmFjZXMvaWxhdGxvbmcnO1xuaW1wb3J0IHsgTWFwTGFiZWwgfSBmcm9tICcuL21hcC1sYWJlbCc7XG5cbmxldCBpZDogbnVtYmVyID0gMDtcblxuLyoqXG4gKiBBYnN0cmFjdCBiYXNlIGltcGxlbWVudGluZyBhIGNhbnZhcyBvdmVybGF5IHRvIGJlIHBsYWNlZCBvbiB0aGUgbWFwLlxuICpcbiAqIEBleHBvcnRcbiAqIEBhYnN0cmFjdFxuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQ2FudmFzT3ZlcmxheSB7XG5cbiAgICAvLy9cbiAgICAvLy8gZmllbGQgZGVjbGFyYXRpb25zXG4gICAgLy8vXG4gICAgcHJvdGVjdGVkIF9yZWFkeVJlc29sdmVyOiAodmFsOiBib29sZWFuKSA9PiB2b2lkO1xuICAgIHByb3RlY3RlZCBfY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudDtcbiAgICBwcm90ZWN0ZWQgX3pvb21TdGFydDogbnVtYmVyO1xuICAgIHByb3RlY3RlZCBfY2VudGVyU3RhcnQ6IElMYXRMb25nO1xuICAgIHB1YmxpYyBfY2FudmFzUmVhZHk6IFByb21pc2U8Ym9vbGVhbj4gPSBuZXcgUHJvbWlzZTxib29sZWFuPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7IHRoaXMuX3JlYWR5UmVzb2x2ZXIgPSByZXNvbHZlOyB9KTtcblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBwcm9taXNlIHRoYXQgZ2V0cyByZXNvbHZlZCB3aGVuIHRoZSBjYW52YXMgb3ZlcmxheSBpcyByZWFkeSBmb3IgaW50ZXJhY3Rpb24uXG4gICAgICovXG4gICAgcHVibGljIGdldCBDYW52YXNSZWFkeSgpOiBQcm9taXNlPGJvb2xlYW4+IHsgcmV0dXJuIHRoaXMuX2NhbnZhc1JlYWR5OyB9XG5cbiAgICAvKipcbiAgICAqIEEgY2FsbGJhY2sgZnVuY3Rpb24gdGhhdCBpcyB0cmlnZ2VyZWQgd2hlbiB0aGUgY2FudmFzIGlzIHJlYWR5IHRvIGJlIHJlbmRlcmVkIGZvciB0aGUgY3VycmVudCBtYXAgdmlldy5cbiAgICAqL1xuICAgIHByaXZhdGUgX2RyYXdDYWxsYmFjazogKGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQpID0+IHZvaWQ7XG5cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIENhbnZhc092ZXJsYXkgY2xhc3MuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZHJhd0NhbGxiYWNrOiAoY2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCkgPT4gdm9pZCkge1xuICAgICAgICB0aGlzLl9kcmF3Q2FsbGJhY2sgPSBkcmF3Q2FsbGJhY2s7XG4gICAgICAgIGlkKys7XG4gICAgfVxuXG4gICAgLy8vXG4gICAgLy8vIFB1YmxpYyBtZXRob2RzXG4gICAgLy8vXG5cbiAgICAvKipcbiAgICAgKiBEZWxldGVzIHRoZSBjYW52YXMgb3ZlcmxheS5cbiAgICAgKi9cbiAgICBwdWJsaWMgRGVsZXRlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLlNldE1hcChudWxsKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBPYnRhaW5zIGdlbyBjb29yZGluYXRlcyBmb3IgdGhlIGNsaWNrIGxvY2F0aW9uXG4gICAgICovXG4gICAgcHVibGljIGFic3RyYWN0IEdldENvb3JkaW5hdGVzRnJvbUNsaWNrKGU6IGFueSk6IElMYXRMb25nO1xuXG5cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBtYXAgYXNzb2NpdGVkIHdpdGggdGhlIGxhYmVsLlxuICAgICAqL1xuICAgIHB1YmxpYyBhYnN0cmFjdCBHZXRNYXAoKTogYW55O1xuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIE1hcExhYmVsIGluc3RhbmNlIGZvciB0aGUgY3VycmVudCBwbGF0Zm9ybSB0aGF0IGNhbiBiZSB1c2VkIGFzIGEgdG9vbHRpcC5cbiAgICAgKiBUaGlzIG1ldGhvZCBvbmx5IGdlbmVyYXRlcyB0aGUgbWFwIGxhYmVsLiBDb250ZW50IGFuZCBwbGFjZW1lbnQgaXMgdGhlIHJlc3BvbnNpYmlsaXR5XG4gICAgICogb2YgdGhlIGNhbGxlci5cbiAgICAgKi9cbiAgICBwdWJsaWMgYWJzdHJhY3QgR2V0VG9vbFRpcE92ZXJsYXkoKTogTWFwTGFiZWw7XG5cbiAgICAvKipcbiAgICAgKiBDYW52YXNPdmVybGF5IGFkZGVkIHRvIG1hcCwgbG9hZCBjYW52YXMuXG4gICAgICovXG4gICAgcHVibGljIE9uQWRkKCk6IHZvaWQge1xuICAgICAgICB0aGlzLl9jYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICAgICAgdGhpcy5fY2FudmFzLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcbiAgICAgICAgdGhpcy5fY2FudmFzLnN0eWxlLmxlZnQgPSAnMHB4JztcbiAgICAgICAgdGhpcy5fY2FudmFzLnN0eWxlLnRvcCA9ICcwcHgnO1xuICAgICAgICB0aGlzLl9jYW52YXMuaWQgPSBgeE1hcE92ZXJsYXkke2lkfWA7XG5cbiAgICAgICAgLy8gQWRkIHRoZSBjYW52YXMgdG8gdGhlIG92ZXJsYXkuXG4gICAgICAgIHRoaXMuU2V0Q2FudmFzRWxlbWVudCh0aGlzLl9jYW52YXMpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENhbnZhc092ZXJsYXkgbG9hZGVkLCBhdHRhY2ggbWFwIGV2ZW50cyBmb3IgdXBkYXRpbmcgY2FudmFzLlxuICAgICAqIEBhYnN0cmFjdFxuICAgICAqIEBtZXRob2RcbiAgICAgKiBAbWVtYmVyb2YgQ2FudmFzT3ZlcmxheVxuICAgICAqL1xuICAgIHB1YmxpYyBhYnN0cmFjdCBPbkxvYWQoKTogdm9pZDtcblxuICAgIC8qKlxuICAgICAqIFdoZW4gdGhlIENhbnZhc0xheWVyIGlzIHJlbW92ZWQgZnJvbSB0aGUgbWFwLCByZWxlYXNlIHJlc291cmNlcy5cbiAgICAgKiBAbWVtYmVyb2YgQ2FudmFzT3ZlcmxheVxuICAgICAqIEBtZXRob2RcbiAgICAgKi9cbiAgICBwdWJsaWMgT25SZW1vdmUoKTogdm9pZCB7XG4gICAgICAgIHRoaXMuU2V0Q2FudmFzRWxlbWVudChudWxsKTtcbiAgICAgICAgdGhpcy5SZW1vdmVFdmVudEhhbmRsZXJzKCk7XG4gICAgICAgIHRoaXMuX2NhbnZhcyA9IG51bGw7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVkcmF3cyB0aGUgY2FudmFzIGZvciB0aGUgY3VycmVudCBtYXAgdmlldy5cbiAgICAgKiBAcGFyYW0gY2xlYXIgLSBUcnVlIHRvIGNsZWFyIHRoZSBjYW52YXMgYmVmb3JlIGRyYXdpbmcuXG4gICAgICogQG1lbWJlcm9mIENhbnZhc092ZXJsYXlcbiAgICAgKiBAbWV0aG9kXG4gICAgICovXG4gICAgcHVibGljIFJlZHJhdyhjbGVhcjogYm9vbGVhbik6IHZvaWQge1xuICAgICAgICBpZiAodGhpcy5fY2FudmFzID09IG51bGwpIHsgcmV0dXJuOyB9XG5cbiAgICAgICAgLy8gQ2xlYXIgY2FudmFzIGJ5IHVwZGF0aW5nIGRpbWVuc2lvbnMuIFRoaXMgYWxzbyBlbnN1cmVzIGNhbnZhcyBzdGF5cyB0aGUgc2FtZSBzaXplIGFzIHRoZSBtYXAuXG4gICAgICAgIGlmIChjbGVhcikgeyB0aGlzLlJlc2l6ZSgpOyB9XG5cbiAgICAgICAgLy8gQ2FsbCB0aGUgZHJhd2luZyBjYWxsYmFjayBmdW5jdGlvbiBpZiBzcGVjaWZpZWQuXG4gICAgICAgIGlmICh0aGlzLl9kcmF3Q2FsbGJhY2spIHtcbiAgICAgICAgICAgIHRoaXMuX2RyYXdDYWxsYmFjayh0aGlzLl9jYW52YXMpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgbWFwIGZvciB0aGUgbGFiZWwuIFNldHRpbmdzIHRoaXMgdG8gbnVsbCByZW1vdmUgdGhlIGxhYmVsIGZyb20gaHRlIG1hcC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBtYXAgLSBBIG5hdGl2ZSBtYXAgb2JqZWN0IGZvciB0aGUgdW5kZXJseWluZyBpbXBsZW1lbnRhdGlvbi4gSW1wbGVtZW50aW5nIGRlcml2YXRpdmVzIHNob3VsZCByZXR1cm4gdGhlXG4gICAgICogYWN0dWFsIG5hdGl2ZSBvYmplY3QuXG4gICAgICogQG1lbWJlcm9mIENhbnZhc092ZXJsYXlcbiAgICAgKiBAbWV0aG9kXG4gICAgICovXG4gICAgcHVibGljIGFic3RyYWN0IFNldE1hcChtYXA6IGFueSk6IHZvaWQ7XG5cbiAgICAvLy9cbiAgICAvLy8gUHJvdGVjdGVkIG1ldGhvZHNcbiAgICAvLy9cblxuICAgIC8qKlxuICAgICAqIEF0dGFjaGVzIHRoZSBjYW52YXMgdG8gdGhlIG1hcC5cbiAgICAgKiBAbWVtYmVyb2YgQ2FudmFzT3ZlcmxheVxuICAgICAqIEBtZXRob2RcbiAgICAgKi9cbiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgU2V0Q2FudmFzRWxlbWVudChlbDogSFRNTENhbnZhc0VsZW1lbnQpOiB2b2lkO1xuXG4gICAgLyoqXG4gICAgICogUmVtb3ZlIHRoZSBtYXAgZXZlbnQgaGFuZGxlcnMuXG4gICAgICogQG1lbWJlcm9mIENhbnZhc092ZXJsYXlcbiAgICAgKiBAbWV0aG9kXG4gICAgICogQGFic3RyYWN0XG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIHByb3RlY3RlZCBhYnN0cmFjdCBSZW1vdmVFdmVudEhhbmRsZXJzKCk6IHZvaWQ7XG5cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHRoZSBDYW52YXMgc2l6ZSBiYXNlZCBvbiB0aGUgbWFwIHNpemUuXG4gICAgICogQG1lbWJlcm9mIENhbnZhc092ZXJsYXlcbiAgICAgKiBAbWV0aG9kXG4gICAgICogQGFic3RyYWN0XG4gICAgICogQHByb3RlY3RlZFxuICAgICAqL1xuICAgIHByb3RlY3RlZCBhYnN0cmFjdCBSZXNpemUoKTogdm9pZDtcblxuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgdGhlIENhbnZhcy5cbiAgICAgKiBAbWVtYmVyb2YgQ2FudmFzT3ZlcmxheVxuICAgICAqIEBtZXRob2RcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgcHJvdGVjdGVkIGFic3RyYWN0IFVwZGF0ZUNhbnZhcygpOiB2b2lkO1xuXG4gICAgLyoqXG4gICAgICogU2ltcGxlIGZ1bmN0aW9uIGZvciB1cGRhdGluZyB0aGUgQ1NTIHBvc2l0aW9uIGFuZCBkaW1lbnNpb25zIG9mIHRoZSBjYW52YXMuXG4gICAgICogQHBhcmFtIHggVGhlIGhvcml6b250YWwgb2Zmc2V0IHBvc2l0aW9uIG9mIHRoZSBjYW52YXMuXG4gICAgICogQHBhcmFtIHkgVGhlIHZlcnRpY2FsIG9mZnNldCBwb3NpdGlvbiBvZiB0aGUgY2FudmFzLlxuICAgICAqIEBwYXJhbSB3IFRoZSB3aWR0aCBvZiB0aGUgY2FudmFzLlxuICAgICAqIEBwYXJhbSBoIFRoZSBoZWlnaHQgb2YgdGhlIGNhbnZhcy5cbiAgICAgKiBAbWVtYmVyb2YgQ2FudmFzT3ZlcmxheVxuICAgICAqIEBtZXRob2RcbiAgICAgKiBAcHJvdGVjdGVkXG4gICAgICovXG4gICAgcHJvdGVjdGVkIFVwZGF0ZVBvc2l0aW9uKHg6IG51bWJlciwgeTogbnVtYmVyLCB3OiBudW1iZXIsIGg6IG51bWJlcikge1xuICAgICAgICAvLyBVcGRhdGUgQ1NTIHBvc2l0aW9uLlxuICAgICAgICB0aGlzLl9jYW52YXMuc3R5bGUubGVmdCA9IHggKyAncHgnO1xuICAgICAgICB0aGlzLl9jYW52YXMuc3R5bGUudG9wID0geSArICdweCc7XG5cbiAgICAgICAgLy8gVXBkYXRlIENTUyBkaW1lbnNpb25zLlxuICAgICAgICB0aGlzLl9jYW52YXMuc3R5bGUud2lkdGggPSB3ICsgJ3B4JztcbiAgICAgICAgdGhpcy5fY2FudmFzLnN0eWxlLmhlaWdodCA9IGggKyAncHgnO1xuICAgIH1cblxufVxuIl19